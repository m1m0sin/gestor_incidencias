name: Validate Branch Name

on:
  create:
  push:
    branches-ignore:
      - main
      - develop

jobs:
  validate-branch-name:
    name: Validate Branch Naming Convention
    runs-on: ubuntu-latest

    steps:
      - name: Extract branch name
        id: extract
        run: |
          # En eventos de creación o push, obtener el nombre de la rama
          ref="${GITHUB_REF##*/}"
          echo "branch=$ref" >> $GITHUB_OUTPUT
          echo "Checking branch name: $ref"

      - name: Validate branch name pattern
        run: |
          BRANCH_NAME="${{ steps.extract.outputs.branch }}"
          PATTERN='^(feature|release|hotfix|bugfix)\-([a-z0-9\.](-?[a-z0-9\.]){0,23})$'

          if [[ ! "$BRANCH_NAME" =~ $PATTERN ]]; then
            echo "❌ Invalid branch name: \"$BRANCH_NAME\""
            echo "Branch names must match pattern:"
            echo "$PATTERN"
            exit 1
          else
            echo "✅ Valid branch name: \"$BRANCH_NAME\""
          fi